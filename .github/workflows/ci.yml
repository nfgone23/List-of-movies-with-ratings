name: CI for Movies Repository

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  validate-data:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: Validate data files
      run: |
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
        if [ ! -f "README.md" ]; then
          echo "‚ùå README.md –Ω–µ –Ω–∞–π–¥–µ–Ω"
          exit 1
        fi
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º JSON —Ñ–∞–π–ª—ã (–µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å)
        if ls *.json 1> /dev/null 2>&1; then
          echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º JSON —Ñ–∞–π–ª—ã..."
          for file in *.json; do
            python -m json.tool "$file" > /dev/null || exit 1
            echo "‚úÖ $file - –≤–∞–ª–∏–¥–Ω—ã–π JSON"
          done
        fi
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º CSV —Ñ–∞–π–ª—ã (–µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å)
        if ls *.csv 1> /dev/null 2>&1; then
          echo "üìä –ù–∞–π–¥–µ–Ω—ã CSV —Ñ–∞–π–ª—ã"
        fi
        
        echo "‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã"

  check-formatting:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Check file formatting
      run: |
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–µ—Ç trailing whitespace
        if grep -r '[[:space:]]$' --include="*.md" --include="*.json" --include="*.csv" .; then
          echo "‚ùå –ù–∞–π–¥–µ–Ω trailing whitespace"
          exit 1
        fi
        
        echo "‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø–æ—Ä—è–¥–∫–µ"

  test-scripts:
    runs-on: ubuntu-latest
    needs: [validate-data, check-formatting]
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: Test Python scripts
      run: |
        echo "üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å–∫—Ä–∏–ø—Ç–æ–≤..."
        
        # –ï—Å–ª–∏ –µ—Å—Ç—å Python —Å–∫—Ä–∏–ø—Ç—ã, –∑–∞–ø—É—Å–∫–∞–µ–º –∏—Ö —Å —Ñ–ª–∞–≥–æ–º --help –∏–ª–∏ —Å—É—Ö–∏–º –∑–∞–ø—É—Å–∫–æ–º
        if ls *.py 1> /dev/null 2>&1; then
          for script in *.py; do
            if [ -f "$script" ]; then
              echo "üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º $script"
              # –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∑–∞–ø—É—Å–∫–∞
              if python "$script" --help 2>/dev/null; then
                echo "‚úÖ $script: --help —Ä–∞–±–æ—Ç–∞–µ—Ç"
              elif python "$script" --dry-run 2>/dev/null; then
                echo "‚úÖ $script: --dry-run —Ä–∞–±–æ—Ç–∞–µ—Ç"
              elif python "$script" --version 2>/dev/null; then
                echo "‚úÖ $script: --version —Ä–∞–±–æ—Ç–∞–µ—Ç"
              else
                echo "‚ö†Ô∏è $script: —Ç—Ä–µ–±—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"
                # –ü—Ä–æ–±—É–µ–º –ø—Ä–æ—Å—Ç–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
                python -m py_compile "$script" && echo "‚úÖ $script: —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω"
              fi
            fi
          done
        else
          echo "üìù Python —Å–∫—Ä–∏–ø—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ - —Ç–µ—Å—Ç—ã –ø—Ä–æ–ø—É—â–µ–Ω—ã"
        fi
        
    - name: Check Python syntax
      run: |
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –≤—Å–µ—Ö Python —Ñ–∞–π–ª–æ–≤
        if ls *.py 1> /dev/null 2>&1; then
          echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å Python —Ñ–∞–π–ª–æ–≤..."
          for script in *.py; do
            python -m py_compile "$script" && echo "‚úÖ $script: —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω"
          done
        fi
